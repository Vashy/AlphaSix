version: '3.3'

services:

  jenkins:
    image: jenkins/jenkins:lts
    container_name: jenkins
    hostname: jenkins
    restart: always
    ports: 
      - 1500:8080
    logging:
      driver: "json-file"
      options:
        max-size: 10m
        max-file: "3"

  postgres:
    image: postgres:11-alpine
    restart: always
    container_name: postgres_redmine
    hostname: postgres_redmine
    volumes:
      - postgres-data:/var/lib/postgresql/data
    environment:
      - 'POSTGRES_PASSWORD=password'
      - 'POSTGRES_DB=redmine'

  redmine:
    image: redmine:3
    restart: always
    container_name: redmine
    hostname: redmine
    volumes:
      - ./plugins/redmine:/usr/src/redmine/plugins
      - redmine-data:/usr/src/redmine/files
    ports:
      - 3000:3000
    depends_on:
      - postgres
    environment:
      - 'REDMINE_PLUGINS_MIGRATE=true'
      - 'REDMINE_HTTPS=false'
      - 'REDMINE_DB_POSTGRES=postgres'
      - 'REDMINE_DB_DATABASE=redmine'
      - 'REDMINE_DB_PASSWORD=password'

  gitlab:
    image: 'gitlab/gitlab-ce:latest'
    container_name: gitlab
    hostname: gitlab
    restart: always
    ports:
      - '4080:80'
      - '4443:443'
      - '4022:22'
    volumes:
      - '/srv/gitlab/config:/etc/gitlab'
      - '/srv/gitlab/logs:/var/log/gitlab'
      - '/srv/gitlab/data:/var/opt/gitlab'
    logging:
      driver: "json-file"
      options:
        max-size: 10m
        max-file: "3"
  
#  telegram_consumer:
#    image: telegram_consumer
#    container_name: telegram_consumer
#    hostname: telegram_consumer
#    build:
#      context: ../BotTelegram
#      dockerfile: ../BotTelegram/Dockerfile
#    ports:
#      - 5000:5000
#    stdin_open: true
#    tty: true
#    logging:
#      driver: "json-file"
#      options:
#        max-size: 10m
#        max-file: "3"

volumes:
  postgres-data:
  redmine-data: